= content_for :title do
  %h3.project-title
    Runner ##{@runner.id}
    .pull-right
      - if @runner.shared?
        %span.runner-state.runner-state-shared
          共享的
      - else
        %span.runner-state.runner-state-specific
          特定的



- if @runner.shared?
  .bs-callout.bs-callout-success
    %h4 此 runner 将会处理所有<b>未指派</b>项目的构建
    %p
      如果你想让此 runner 只会处理指派项目的构建，请在下面的表格中启用相关项目的指派。
      需要注意的是，此操作只能一次。一旦指定，此 runner 将不能再转为共享的。
- else
  .bs-callout.bs-callout-info
    %h4 此 runner 将只会处理<b>指派</b>项目的构建
    %p 你不能再将此 runner 转为共享的。
%hr
= form_for @runner, url: ci_admin_runner_path(@runner), html: { class: 'form-horizontal' } do |f|
  .form-group
    = label_tag :token, class: 'control-label' do
      授权码
    .col-sm-10
      = f.text_field :token, class: 'form-control', readonly: true
  .form-group
    = label_tag :description, class: 'control-label' do
      描述
    .col-sm-10
      = f.text_field :description, class: 'form-control'
  .form-group
    = label_tag :tag_list, class: 'control-label' do
      标签列表
    .col-sm-10
      = f.text_field :tag_list, class: 'form-control'
      .help-block 你可以设置构建只使用指定标签的 runner
  .form-actions
    = f.submit '保存', class: 'btn btn-save'

.row
  .col-md-6
    %h4 此 runner 指派的项目
    - if @runner.projects.any?
      %table.table
        %thead
          %tr
            %th 指派的项目
            %th
        - @runner.runner_projects.each do |runner_project|
          - project = runner_project.project
          %tr.alert-info
            %td
              %strong
                = project.name
            %td
              .pull-right
                = link_to '禁用', [:ci, :admin, project, runner_project], method: :delete, class: 'btn btn-danger btn-xs'

    %table.table
      %thead
        %tr
          %th 项目
          %th
            .pull-right
              = link_to '指派给所有', assign_all_ci_admin_runner_path(@runner),
                class: 'btn btn-sm assign-all-runner',
                title: '指派 runner 给所有项目',
                method: :put

      %tr
        %td
          = form_tag ci_admin_runner_path(@runner), id: 'runner-projects-search', class: 'form-inline', method: :get do
            .form-group
              = search_field_tag :search, params[:search], class: 'form-control'
            = submit_tag '搜索', class: 'btn'

        %td
      - @projects.each do |project|
        %tr
          %td
            = project.name
          %td
            .pull-right
              = form_for [:ci, :admin, project, project.runner_projects.new] do |f|
                = f.hidden_field :runner_id, value: @runner.id
                = f.submit '启用', class: 'btn btn-xs'
    = paginate @projects

  .col-md-6
    %h4 此 runner 最近完成的构建
    %table.builds.runner-builds
      %thead
        %tr
          %th 状态
          %th 项目
          %th 提交
          %th 结束时间

      - @builds.each do |build|
        %tr.build
          %td.status
            = ci_status_with_icon(build.status)

          %td.status
            = build.project.name

          %td.build-link
            = link_to ci_project_build_path(build.project, build) do
              %strong #{build.short_sha}

          %td.timestamp
            - if build.finished_at
              %span #{time_ago_in_words build.finished_at}之前
