- page_title "CI/CD 管道"

.row.prepend-top-default
  .col-lg-3.profile-settings-sidebar
    %h4.prepend-top-0
      = page_title
  .col-lg-9
    %h5.prepend-top-0
      管道
    = form_for @project, url: namespace_project_pipelines_settings_path(@project.namespace.becomes(Namespace), @project), remote: true, authenticity_token: true do |f|
      %fieldset.builds-feature
        - unless @repository.gitlab_ci_yml
          .form-group
            %p 管道需要在您开始使用连续集成之前进行配置。
            = link_to 'Get started with CI/CD Pipelines', help_page_path('ci/quick_start/README'), class: 'btn btn-info'
        .form-group
          %p 使用以下命令获取最近的应用程序代码：
          .radio
            = f.label :build_allow_git_fetch_false do
              = f.radio_button :build_allow_git_fetch, 'false'
              %strong git clone
              %br
              %span.descr 缓慢但确保你在每个构建都有一个干净的目录
          .radio
            = f.label :build_allow_git_fetch_true do
              = f.radio_button :build_allow_git_fetch, 'true'
              %strong git fetch
              %br
              %span.descr 快速

        .form-group
          = f.label :build_timeout_in_minutes, '超时', class: 'label-light'
          = f.number_field :build_timeout_in_minutes, class: 'form-control', min: '0'
          %p.help-block 每次构建超时分钟
        .form-group
          = f.label :build_coverage_regex, "测试覆盖率分析", class: 'label-light'
          .input-group
            %span.input-group-addon /
            = f.text_field :build_coverage_regex, class: 'form-control', placeholder: '\(\d+.\d+\%\) covered'
            %span.input-group-addon /
          %p.help-block
            我们将使用这个正则表达式来查找生成跟踪中的测试覆盖率输出。
            如果您想禁用此功能，就留下空白
          .bs-callout.bs-callout-info
            %p 以下是现有工具的正则表达式的例子：
            %ul
              %li
                Simplecov (Ruby) -
                %code \(\d+.\d+\%\) covered
              %li
                pytest-cov (Python) -
                %code \d+\%\s*$
              %li
                phpunit --coverage-text --colors=never (PHP) -
                %code ^\s*Lines:\s*\d+.\d+\%
              %li
                gcovr (C/C++) -
                %code ^TOTAL.*\s+(\d+\%)$
              %li
                tap --coverage-report=text-summary (Node.js) -
                %code ^Statements\s*:\s*([^%]+)

        .form-group
          .checkbox
            = f.label :public_builds do
              = f.check_box :public_builds
              %strong 公共管道
            .help-block 允许任何人进入公共和内部项目的管道

        .form-group.append-bottom-default
          = f.label :runners_token, "Runners 令牌", class: 'label-light'
          = f.text_field :runners_token, class: "form-control", placeholder: 'xEeFCaDAB89'
          %p.help-block 用于签出项目的安全令牌。

        = f.submit '保存修改', class: "btn btn-save"

%hr

.row.prepend-top-default
  .col-lg-3.profile-settings-sidebar
    %h4.prepend-top-0
      构建徽章
  .col-lg-9
    .prepend-top-10
      .panel.panel-default
        .panel-heading
          %b 构建徽章 &middot;
          = @build_badge.to_html
          .pull-right
            = render 'shared/ref_switcher', destination: 'badges', align_right: true
        .panel-body
          .row
            .col-md-2.text-center
              Markdown
            .col-md-10.code.js-syntax-highlight
              = highlight('.md', @build_badge.to_markdown)
          .row
            %hr
          .row
            .col-md-2.text-center
              HTML
            .col-md-10.code.js-syntax-highlight
              = highlight('.html', @build_badge.to_html)
